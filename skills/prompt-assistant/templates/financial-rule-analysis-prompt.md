# 财务规则集结果分析与输出提示词

## 前置条件

你拥有以下信息：
1. 卡片数据
[卡片：AC000003-6.1.1一般企业利润表(新准则产品表)(指标取数)]
[卡片：AC000008-6.1.2一般企业资产负债表(新准则产品表)(指标取数)]
[卡片：AC000014-6.1.4一般企业现金流量表(新准则产品表)(指标取数)]
[卡片：AC000017-6.3审计报告(指标取数)]
[卡片：AC000019-6.2（FF类）利润表 AC000019(指标取数)]
[卡片：AC000020-6.2（FF类）资产负债表(指标取数)]
[卡片：AC000021-6.2（FF类）现金流量表 AC000021(指标取数)]
[卡片：AC000022-6.2（FF类）衍生财务指标 AC000022(指标取数)]
[卡片：AC000023-6.2（FF类）财务附注 AC000023(指标取数)]
[卡片：AC000024-6.2（FF类）财务附注_公司经营情况 AC000024(指标取数)]
[卡片：AC000025-6.2（IB类）行业对比(指标取数)]
[卡片：AC000031-6.2（FF类）季度财务数据指标(指标取数)]
[卡片：SK000002-企业股权质押风险测算(指标取数)]

2. 规则集执行结果
[规则集:FSF_SET_001-财务粉饰规则集]

## 执行任务

### 任务说明

根据规则集的JSON执行结果，生成一份结构化的风险分析报告，包含：
1. **规则执行概览** - 规则集的执行統計信息
2. **规则执行结果表** - 所有规则的汇总表格（含完整的风险提示）
3. **子规则分析表** - 对触发风险的子规则进行展示

---

## 输出格式规范

### 输出结构

```
# [规则集中文名称]：[规则集代码]

## 规则集执行概览

统計信息表格，展示总规则数、执行成功数、执行失败数、执行耗时

## 规则执行结果

### 规则汇总表格

包含编码、规则名称、状态、判断逻辑和风险提示的综合表格

## 子规则分析表

展示相关子规则的执行结果及说明
```

---

## 详细输出规范

### 规则汇总表格

**表格结构：**
| 编码 | 规则名称 | 状态 | 风险提示 |
|-----|--------|------|--------|
| FSF-0001 | 疑似收入过早确认或虚构收入 |  error | 执行失败：[行业平均营业总收入同比增速] [应收账款同比增速(N年)] 等字段缺失 |
| FSF-0031 | 非经常性损益单期推高利润 |  failed | 可能存在通过非经常性损益单次推高净利润的情况。非经常性损益贡献度过高：当前为84.74%，超过阈值30.0%，净利润过度依赖非经常性损益，主营业务盈利能力不足。 |

**填充规则：**
1. **编码**：`rule.code`
2. **规则名称**：`rule.name`
3. **状态**：根据`rule.status`映射
   - success - 执行成功，无风险
   - error - 执行失败（缺必要数据）
   - failed - 执行成功但触发风险
   - warning - 执行成功但存在预警
4. **风险提示**：完整的风险提示文本（按下一章节的规范生成）

---

## 风险提示生成规范 - 在表格中的"风险提示"列显示

### 风险提示的格式

对于**status为error的规则**：

```
失败原因：[缺失字段列表]
```

示例：
```
失败原因：[行业平均营业总收入同比增速] [应收账款同比增速(N年)] 等字段缺失
```

对于**status为failed或warning的规则**：

```
[风险提示核心内容]。[触发子规则1：实际值与阈值对比]；
[逻辑关系：且/或/非] [触发子规则2：实际值与阈值对比]；
[逻辑关系] [触发子规则3：实际值与阈值对比]。
```

### 详细说明

需要按以下方式组织：

1. **第一句 - 风险提示**：
   - 来源：`rule.risk_message` 的核心风险描述
   - 要求：简洁、明确表达主要风险

2. **接续句 - 子规则触发说明**：
   - 查找：逐一解析`logic_expression`中的子规则代码
   - 筛选：只列出状态为"failed"或"warning"的子规则
   - 描述：使用子规则的`description`字段
   - 格式：[子规则说明]

3. **逻辑关系连接**：
   - 根据`logic_expression`中的AND、OR、NOT逻辑：
     - AND → 使用"**且**"
     - OR → 使用"**或**"
     - NOT → 使用"**非**"或"**不存在**"
   - 保持多个子规则的逻辑顺序

4. **数据支撑**：
   - 包含具体的数值对比（实际值 vs 阈值）
   - 包含业务含义解释（为什么这个指标异常）
   - 必要时添加具体数据来源说明

### 真实样例解析

**题目规则：** FSF-0002-通过不公允关联交易虚增利润

**逻辑表达式：** `IB-0002 AND (FF-0005 OR FF-0006)`

**子规则状况：**
- IB-0002 (销售毛利率过高) → n/a（数据缺失）
- FF-0005 (销售集中度异常) → failed（实际10.67% > 阈值10%）
- FF-0006 (采购集中度异常) → 未在结果中或n/a

**表格中的风险提示列应显示：**
```
通过不公允关联交易虚增利润的风险。销售集中度异常，前五大客户销售占比为10.67%，超过阈值10%，表明销售渠道过于集中，存在重大客户依赖风险；但销售毛利率相关数据缺失，无法完整评估关联交易风险。
```

### 对复杂逻辑的处理

**情景：多个子规则同时触发**

规则代码：FSF-0011-存贷双高（造假2.0版）
逻辑表达式：`(FF-0027 AND FF-0028) AND (FF-0029 OR FF-0030 OR FF-0031)`

假设FF-0027、FF-0028、FF-0030都failed，则表格中显示：

```
存贷双高现象存在融资成本与融资规模不匹配的风险。有息负债同比17.98%，超过10%，有息负债增加；且[FF-0028的说明]；且财务费用同比增长，融资成本上升，与融资规模增加形成双高局面。
```

**情景：有NOT逻辑的规则**

规则代码：FSF-0005-少计成本-存货资本化
逻辑表达式：`(IB-0008 AND FF-0013 AND IB-0005) AND NOT IB-0006`

含义：只有在IB-0006（行业景气度为上行周期）不满足时，其他条件才能触发风险。表格中显示：

```
存货异常增长存在少计成本的风险。存货周转天数同比增长25.17%，超过20%，增长过高；且营业毛利率同比异常；但行业景气度为下行周期，部分业务下滑可以解释存货积压现象。
```

---

## 子规则分析表

**表格结构：**
| 编码 | 子规则名称 | 状态 | 实际值 | 阈值 | 说明 |
|-----|---------|------|--------|------|------|
| FF-0002 | 经营活动现金流量净额/净利润比持续小于1 |  warning | -3.92 | 1.0 | 经营活动现金流量净额/净利润为-3.92（仅2024年数据） |
| FF-0005 | 销售集中度异常 |  failed | 10.67 | 10 | 前五大客户销售占比为10.67%，超过阈值10%... |

**填充规则：**
1. 只展示**status为failed或warning的子规则**
2. 或者展示**与某个failed/warning规则相关的所有子规则**
3. 按照编码顺序排列
4. 状态映射同上

---

## 处理规则 - 必须遵守

### 1. 状态映射表

| JSON值 | 展示 | 含义 |
|-------|------|------|
| success |  success | 规则执行成功，未触发风险 |
| error |  error | 规则执行失败，缺少必要数据 |
| failed |  failed | 规则执行成功，已触发风险 |
| warning |  warning | 规则执行成功，存在预警 |
| n/a |  n/a | 规则无法评估，缺少必要数据 |

### 2. 风险提示的聚合优先级

多个子规则触发时，按以下优先级展示：
1. **第一优先**：failed状态的子规则（直接风险）
2. **第二优先**：warning状态的子规则（潜在风险）
3. **第三优先**：n/a状态的子规则（信息缺失）
4. **不展示**：success状态的子规则

### 3. 逻辑表达式处理

- **保持原始形式**：不要简化或重新组织表达式
- **括号保留**：保留所有的括号关系
- **运算符统一**：AND、OR、NOT保持大写

### 4. 数值精度

- **保留原始精度**：不四舍五入
- **对比格式**：`实际值{value}，阈值{threshold}，差异{value-threshold}`

### 5. 无数据处理

对于缺失的子规则数据：
```
[缺失的字段名称]：数据缺失
```

---

## 输出检验清单

生成输出前，请验证：
- [ ] 所有规则都在汇总表中
- [ ] 每个failed/warning规则在表格中都有完整的风险提示
- [ ] 每个error规则在表格中都有失败原因说明
- [ ] 风险提示中包含了具体的数值对比（实际值vs阈值）
- [ ] 逻辑关系（且/或/非）使用正确
- [ ] 表格格式正确（markdown标准表格）
- [ ] 状态emoji映射正确
- [ ] 表格的"风险提示"列中的数据与子规则表格中的数据一致
- [ ] 没有遗漏任何failed/warning的规则和它们的风险提示
